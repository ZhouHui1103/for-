# 飞书多维表格自动部署工具

本工具可以根据Markdown格式的表格定义，自动创建和部署飞书多维表格应用。它是将业务分析文档（L2核心元数据定义、L3流程架构）系统性地转化为功能性飞书多维表格数据库的最后一步自动化工具。

## 功能特点

- 自动创建新的多维表格应用
- 自动解析Markdown文件中的表格定义
- 自动创建表格和字段
- 支持多种字段类型（文本、数字、单选、多选、日期等）
- 支持表格间的关联关系
- 支持公式、汇总、查找等高级字段类型

## 完整工作流程

### 第一步：业务分析与规范设计

使用`L2&L3到飞书表格的生成规范.md`作为指导，进行以下工作：

1. 从L2核心元数据定义文档中识别核心业务对象
2. 将每个业务对象映射为一个数据表
3. 将对象的状态和类别映射为单选/多选字段
4. 将对象之间的关联关系映射为关联字段
5. 使用L3流程文档验证数据结构的完整性

### 第二步：创建表格框架文档

基于`飞书多维表格框架模板.md`，创建类似`ADHD督导业务 L3 - 飞书多维表格框架.md`的文档：

1. 按照模板中的表格格式定义每个业务表
2. 为每个表格定义字段、类型和选项
3. 明确标记主字段（在字段名称后加上"(主字段)"）
4. 定义表格之间的关联关系
5. 添加公式、汇总、查找等高级字段

### 第三步：自动部署

使用本工具将框架文档自动部署到飞书多维表格：

1. 配置工具
2. 运行脚本
3. 获取新创建的多维表格链接

## 使用方法

1. 确保已安装Python 3.6+
2. 安装依赖：`pip install lark-oapi`
3. 配置`deployer.py`文件中的APP_ID和APP_SECRET
4. 准备好Markdown格式的表格定义文件（如`ADHD督导业务 L3 - 飞书多维表格框架.md`）
5. 运行`run.bat`或在命令行中执行：
   ```
   cd 脚本所在目录
   python deployer.py
   ```

## 配置说明

在`deployer.py`文件顶部配置区域填写：

```python
APP_ID = "你的飞书应用ID"
APP_SECRET = "你的飞书应用密钥"
MARKDOWN_FILE = "你的Markdown表格定义文件名"
```

## Markdown格式要求

Markdown文件中的表格定义需要遵循以下格式：

```markdown
### 表格名称

| 字段名称 | 字段类型 | 选项 / 说明 |
| ------- | ------- | ---------- |
| 字段1(主字段) | 文本 | 这是主字段 |
| 字段2 | 单选 | 选项A, 选项B, 选项C |
| 字段3 | 关联 | 关联到`另一个表格`表 |
```

### 支持的字段类型

- **基础类型**：文本、数字、单选、多选、日期、复选框、人员
- **高级类型**：关联、公式、货币、URL、创建时间、自动编号、查找、汇总
- **UI变体**：对于数字类型，支持进度、货币、评分等UI变体

### 特殊格式说明

- **主字段标记**：在字段名称后加上"(主字段)"，如`客户名称(主字段)`
- **单选/多选选项**：在选项/说明列中用逗号分隔，如`选项A, 选项B, 选项C`
- **关联字段**：在选项/说明列中使用格式`关联到`表格名称`表`，如`关联到`客户信息`表`
- **公式字段**：在选项/说明列中使用格式`公式: 表达式`，如`公式: {总容量} - {已负责数量}`

## 从L2/L3到飞书表格的转换原则

1. **对象即数据表**：L2文档中定义的每一个业务对象都映射为一张独立数据表
2. **状态/类别即选项**：对象的状态和类别映射为单选/多选字段的选项
3. **关联即链接**：对象的关联关系映射为表格间的关联字段
4. **流程驱动数据校验**：通过L3流程文档验证和丰富数据表设计

## 注意事项

- 确保飞书应用有足够的权限（bitable:app:read, bitable:app:write）
- 表格名称不能以数字或点开头
- 主字段需要在字段名称后加上"(主字段)"标记
- 关联字段需要在选项/说明中指明关联的表格名称
- 脚本会自动创建一个新的多维表格应用，不会修改现有的表格

## 常见问题

**Q: 为什么创建表格失败？**
A: 可能是应用权限不足，请确保应用已发布并开启了必要的权限。

**Q: 如何查看创建的多维表格？**
A: 脚本执行成功后会显示访问链接。

**Q: 如何处理表格间的复杂关联关系？**
A: 在Markdown文件中正确定义关联关系后，脚本会自动处理表格间的关联。对于双向关联，需要在两个表格中都定义关联字段。

## 更多帮助

如需更多帮助，请参考：
- [飞书开放平台文档](https://open.feishu.cn/document/ukTMukTMukTM/uUDN04SN0QjL1QDN/bitable-overview)
- 项目中的`L2&L3到飞书表格的生成规范.md`
- 项目中的`飞书多维表格框架模板.md`