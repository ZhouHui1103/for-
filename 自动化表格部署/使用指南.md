# 飞书多维表格自动部署工具使用指南

## 前置准备

### 1. 创建飞书应用

1. 访问[飞书开发者平台](https://open.feishu.cn/app)
2. 点击"创建企业自建应用"
3. 填写应用名称、描述等基本信息
4. 创建完成后，在"凭证与基础信息"页面获取App ID和App Secret

### 2. 配置应用权限

1. 在应用管理页面，找到"权限管理"
2. 添加以下权限：
   - `bitable:app:read` (读取多维表格)
   - `bitable:app:write` (编辑多维表格)
3. 点击"版本管理与发布"，创建并发布新版本
4. 设置应用可用范围为"全员可用"

### 3. 准备Markdown表格定义文件

创建一个Markdown文件，按以下格式定义表格结构：

```markdown
### 客户信息表

| 字段名称 | 字段类型 | 选项 / 说明 |
| ------- | ------- | ---------- |
| 客户名称(主字段) | 文本 | 客户的全称 |
| 联系人 | 人员 | 负责联系的人员 |
| 客户类型 | 单选 | A类, B类, C类 |
| 合作状态 | 多选 | 潜在, 洽谈中, 已合作, 暂停 |

### 产品清单表

| 字段名称 | 字段类型 | 选项 / 说明 |
| ------- | ------- | ---------- |
| 产品名称(主字段) | 文本 | 产品的名称 |
| 产品编号 | 自动编号 | 产品的唯一编号 |
| 价格 | 货币 | 产品的单价 |
| 所属客户 | 关联 | 关联到`客户信息表`表 |
```

## 安装与配置

### 1. 安装Python环境

确保您的电脑已安装Python 3.6或更高版本。

### 2. 安装依赖库

打开命令提示符或终端，运行以下命令：

```bash
pip install lark-oapi
```

### 3. 配置脚本

1. 打开`deployer.py`文件
2. 在配置区填写您的应用凭证：

```python
APP_ID = "您的App ID"
APP_SECRET = "您的App Secret"
MARKDOWN_FILE = "您的Markdown文件名.md"
```

## 运行脚本

### 方法一：使用批处理文件

双击`run.bat`文件运行脚本。

### 方法二：使用命令行

1. 打开命令提示符或终端
2. 切换到脚本所在目录
3. 运行命令：`python deployer.py`

## 运行结果说明

脚本执行成功后，将显示以下信息：

1. 新创建的多维表格应用的APP_TOKEN
2. 创建的表格和字段列表
3. 访问新创建的多维表格的链接

请务必保存显示的APP_TOKEN，以便后续使用。

## 常见问题排查

### 1. 创建表格失败

**可能原因**：
- 应用权限不足
- 应用未发布
- 表格名称不符合规范（不能以数字或点开头）

**解决方法**：
- 检查应用权限是否已配置并发布
- 修改表格名称，确保符合飞书命名规范

### 2. 创建字段失败

**可能原因**：
- 字段类型与选项不匹配
- 关联表格不存在或名称不一致

**解决方法**：
- 检查字段类型和选项是否匹配
- 确保关联表格的名称与Markdown中定义的一致

### 3. 执行脚本时出现编码错误

**可能原因**：
- 终端编码设置问题

**解决方法**：
- 使用`run.bat`批处理文件运行脚本
- 或在命令行中设置正确的编码

## 高级用法

### 1. 自定义表格和字段属性

在Markdown文件中，您可以为字段添加更多属性：

- 主字段：在字段名称后添加`(主字段)`标记
- 关联字段：在选项/说明中使用格式`关联到`表格名称`表`
- 公式字段：在选项/说明中使用格式`公式: 表达式`

### 2. 修改现有表格

如果您需要修改现有的多维表格，可以：

1. 获取现有表格的APP_TOKEN
2. 修改Markdown定义文件
3. 运行脚本，将创建新的表格和字段

## 支持的字段类型

- 文本
- 数字
- 单选
- 多选
- 日期
- 复选框
- 人员
- 关联
- 公式
- 货币
- URL
- 创建时间
- 自动编号
- 查找
- 汇总

## 联系与支持

如有问题，请参考[飞书开放平台文档](https://open.feishu.cn/document/ukTMukTMukTM/uUDN04SN0QjL1QDN/bitable-overview)。
